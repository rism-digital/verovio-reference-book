<!DOCTYPE html>
<html lang="en" xml:lang="en" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta charset="utf-8" />
        <title>Generate code with libMEI</title>
        <link rel="icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="apple-touch-icon" href="/assets/images/verovio-logo-big.png"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" /><!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="/assets/css/bootstrap/css/bootstrap.min.css" type="text/css" /><!-- Optional theme -->
        <link rel="stylesheet" href="/assets/css/bootstrap/css/bootstrap-theme.min.css" type="text/css" />
        <link rel="stylesheet" href="/assets/css/fileinput.min.css" />

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/assets/css/syntax.css" />

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/assets/css/verovio.css" />
        <link rel="stylesheet" href="/assets/css/midiplayer.css" />

        <link rel="stylesheet" href="/css/verovio-site.css" />

        <script src="/assets/javascript/jquery-3.6.0.min.js" type="text/javascript" ></script>
        <script src="/assets/javascript/bootstrap.min.js" type="text/javascript" ></script>

        <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Generate code with libMEI | Reference book for Verovio</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Generate code with libMEI" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Verovio uses a forked version of LibMEI, a library that generates code directly from the MEI schema. It can be adapted to generate code in any language. For Verovio, it is used to generate C++ code. The code generated with LibMEI is included in the Verovio repository in the ./libmei directory and the LibMEI repository does not need to be cloned for building Verovio." />
<meta property="og:description" content="Verovio uses a forked version of LibMEI, a library that generates code directly from the MEI schema. It can be adapted to generate code in any language. For Verovio, it is used to generate C++ code. The code generated with LibMEI is included in the Verovio repository in the ./libmei directory and the LibMEI repository does not need to be cloned for building Verovio." />
<meta property="og:site_name" content="Reference book for Verovio" />
<meta property="og:image" content="https://book.verovio.org/images/card.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-03-01T13:56:23+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="https://book.verovio.org/images/card.png" />
<meta property="twitter:title" content="Generate code with libMEI" />
<meta name="twitter:site" content="@" />
<script type="application/ld+json">
{"description":"Verovio uses a forked version of LibMEI, a library that generates code directly from the MEI schema. It can be adapted to generate code in any language. For Verovio, it is used to generate C++ code. The code generated with LibMEI is included in the Verovio repository in the ./libmei directory and the LibMEI repository does not need to be cloned for building Verovio.","datePublished":"2023-03-01T13:56:23+00:00","dateModified":"2023-03-01T13:56:23+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"/contributing/generate-code-with-libmei.html"},"image":"https://book.verovio.org/images/card.png","url":"/contributing/generate-code-with-libmei.html","@type":"BlogPosting","headline":"Generate code with libMEI","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    </head>
    <body>

        <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
     <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                </button>
            <a class="navbar-brand logo-nav" href="https://www.verovio.org/index.xhtml"><img src="/assets/images/verovio-fadded-50.png" /></a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <ul class="nav navbar-nav navbar-right">
                <li >
                    <a href="https://www.verovio.org/index.xhtml">Homepage</a>
                </li>
                <li class="active">
                    <a href="https://book.verovio.org/">Reference book</a>
                </li>
                <li >
                    <a href="https://www.verovio.org/musicxml.html">Online tools</a>
                </li>
              </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


        <div class="top-header"> 
    <div class="container" style="color: #eee; height: 140px; padding-top: 5px;">
        <h1 style="color: #eee;" class="hidden-print hidden-xs">A music notation engraving library</h1> 
        <h3 style="color: #eee;" class="hidden-print visible-xs">A music notation engraving library</h3> 
        <p class="hidden-print">Designed for the Music Encoding Initiative - Fast - Light - Flexible - No dependencies</p>
    </div>
</div>


        <div class="container with-footer">

            



<div class="row">
    <div class="col-md-3 sidebar-offcanvas" id="sidebar">
        <div class="toc-group">
            <div>

    <a class="toc-item" href="/introduction/">Introduction</a>
    

    <a class="toc-item" href="/first-steps/">Tutorial 1: First Steps</a>
    

    <a class="toc-item" href="/interactive-notation/css-and-svg.html">Tutorial 2: Interactive notation</a>
    

    <a class="toc-item" href="/advanced-topics/">Beyond tutorials: Advanced topics</a>
    

    <a class="toc-item" href="/toolkit-reference/input-formats.html">Toolkit Reference</a>
    

    <a class="toc-item" href="/installing-or-building-from-sources/command-line.html">Installing or building from sources</a>
    

    <a class="toc-item" href="/contributing/guidelines.html">Contributing</a>
    
        
        
<a class="toc-item toc-section " href="/contributing/guidelines.html">Coding guidelines</a>
    

<a class="toc-item toc-section " href="/contributing/workflow.html">Contributing workflow</a>
    

<a class="toc-item toc-section selected" href="/contributing/generate-code-with-libmei.html">Generate code with libMEI</a>
    
        
        
<a class="toc-item toc-subsection" href="#generating-libmei">Generating LibMEI</a>

<a class="toc-item toc-subsection" href="#customization">Customization</a>

    

<a class="toc-item toc-section " href="/contributing/adding-smufl-glyphs.html">Adding SMuFL glyphs</a>
    

    

</div>
            <div id="website-search-form" class="toc-item search-form">
    
    <form action="/search.html">
        <div class="form-group">
            <input id="website-search" class="form-control" type="text" name="q" placeholder="Search the reference book ...">
        </div>
        <button type="submit" class="btn btn-small">Search</button>
    </form>
</div>


        </div>
    </div>

    <div class="col-md-9" id="content">
        
        <a class="hidden-print" href="https://github.com/rism-digital/verovio-reference-book/edit/master/_book/07-contributing/03-generate-code-with-libmei.md"><button class="btn btn-xs pull-right">Edit this page</button></a>
        
        
        <h2>Generate code with libMEI</h2>
        <p>Verovio uses a forked version of <a href="https://github.com/DDMAL/libmei">LibMEI</a>, a library that generates code directly from the MEI schema. It can be adapted to generate code in any language. For Verovio, it is used to generate C++ code. The code generated with LibMEI is included in the Verovio repository in the <code class="language-plaintext highlighter-rouge">./libmei</code> directory and the LibMEI repository does not need to be cloned for building Verovio.</p>

<p>Whenever the MEI schema is modified, this code needs to be re-generated in order to integrate these changes. However, since Verovio implements only a small subset of the MEI schema, this really needs to be done only for the changes in the schema that touch features supported by Verovio. This means that the code within the <code class="language-plaintext highlighter-rouge">./libmei/dist</code> directory should never be edited by hand because any change will be overwritten by the LibMEI output when the code generated from the schema needs to be updated and LibMEI is run again.</p>

<h3 id="generating-libmei">Generating LibMEI</h3>

<p>You can regenerate the LibMEI code with a compiled ODD as input.</p>

<p>Go to the <code class="language-plaintext highlighter-rouge">./libmei/tools</code> directory and run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python parseschema2.py <span class="nt">-c</span> config.yml ../mei/develop/mei-verovio_compiled.odd
</code></pre></div></div>

<h3 id="customization">Customization</h3>

<p>Verovio currently uses an MEI customization that has added or modified a few elements. It is defined in the file <code class="language-plaintext highlighter-rouge">./libmei/mei/develop/mei-verovio.xml</code>. If you want to make changes to it, you can make them there. You will need to regenerate the ODD file <code class="language-plaintext highlighter-rouge">./libmei/mei/develop/mei-verovio_compiled.odd</code>. This can be done with the Edirom <a href="https://meigarage.edirom.de/">MEI Garage</a>. Alternatively, you can also use the MEI command line script. To do so, you need to create a clone of the <a href="https://github.com/music-encoding/music-encoding">MEI</a> repository, copy your customization file (e.g., <code class="language-plaintext highlighter-rouge">mei-verovio.xml</code>) into it and do:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ant init
ant <span class="nt">-lib</span> lib/saxon/saxon9he.jar <span class="nt">-Dcustomization</span>.path<span class="o">=</span>mei-verovio.xml
</code></pre></div></div>

<p>The ODD file will be written to <code class="language-plaintext highlighter-rouge">./dist/schemata/mei-verovio_compiled.odd</code>, which you can use as new input file for LibMEI.</p>

    </div>
</div>

<script src="/js/highlighter.js"></script>

<script>
    let options = {
        rootMargin: '60px'
    }
    function adjustSideBar() {
        elem = document.getElementsByClassName("toc-group")[0];
        // 992 is the breakpoint for which the sidebar moves to the top; 35 is the footer height
        elem.style.height = (window.innerWidth < 992) ? "" : `${window.innerHeight - elem.offsetTop - 35}px`;
    }

    window.onresize = function () {
        adjustSideBar();
    };
    window.onload = function() {
        adjustSideBar();
    };

    window.addEventListener('DOMContentLoaded', () => {
        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                const id = entry.target.getAttribute('id');
                if (entry.intersectionRatio > 0) {
                    // First deselect everything
                    sections = document.querySelectorAll(`.toc-group a.toc-subsection`);
                    for (i = 0; i < sections.length; i++){
                        sections[i].classList.remove('selected');
                    }
                    // The one entering is marked as .on-screen
                    document.querySelector(`.toc-group a[href="#${id}"]`).classList.add('on-screen');
                    // Select the first that in .on-screen
                    sections = document.querySelectorAll(`.toc-group a.toc-subsection.on-screen`);
                    sections[0].classList.add('selected');

                } else {
                    leaving = document.querySelector(`.toc-group a[href="#${id}"]`)
                    // Remove the .on-screen from the one leaving
                    leaving.classList.remove('on-screen');
                    sections = document.querySelectorAll(`.toc-group a.toc-subsection.on-screen`);
                    // If no other one is on screen, just leave things as they are
                    if (sections.length > 0) {
                        // Otherwise de-select the one that is leaving
                        leaving.classList.remove('selected');
                        // Selected the first .on-screen one and de-select the other ones
                        sections[0].classList.add('selected');
                        for (i = 1; i < sections.length; i++){
                            console.log(sections[i].getAttribute('id'))
                            sections[i].classList.remove('selected');
                        }
                    }
                }
            });
        }, options);

        // Track all sections that have an `id` applied
        document.querySelectorAll('h3[id]').forEach((section) => {
            observer.observe(section);
        });

    });

    let params = new URLSearchParams( document.location.search.substring( 1 ) );
    if ( params.get( "q" ) )
    {
        let query = params.get( "q" );
        // Also make sure we preserve the query term in the form in the sidebar
        document.getElementById("website-search").value = query;
        // Preserve the original query for logging
        let query_term = query;
        // Remove quotes and trim
        query = query.replace(/\'|\"/g, ' ');
        query = query.trim();
        // Make it an AND query
        console.log(query);

        let terms = query.split(' ');
        var container = document.getElementById("content");

        for (var i = 0; i < terms.length; i++) {
            InstantSearch.highlight(container, terms[i]);
        }
    }

</script>



        </div>

        <footer class="hidden-print footer navbar-fixed-bottom">
            <p>
                
            </p>
        </footer>

        <script type="text/javascript">
        //<![CDATA[
            $(document).ready(function() {

                

            });
        //]]>
        </script>
    </body>
</html>
