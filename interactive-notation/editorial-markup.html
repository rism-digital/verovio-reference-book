<!DOCTYPE html>
<html lang="en" xml:lang="en" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta charset="utf-8" />
        <link rel="icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="apple-touch-icon" href="/assets/images/verovio-logo-big.png"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" /><!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="/assets/css/bootstrap/css/bootstrap.min.css" type="text/css" /><!-- Optional theme -->
        <link rel="stylesheet" href="/assets/css/bootstrap/css/bootstrap-theme.min.css" type="text/css" />
        <link rel="stylesheet" href="/assets/css/fileinput.min.css" />

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/assets/css/syntax.css" />

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/assets/css/verovio.css" />
        <link rel="stylesheet" href="/assets/css/midiplayer.css" />

        <link rel="stylesheet" href="/css/verovio-site.css" />

        <script src="/assets/javascript/jquery-3.6.0.min.js"></script>
        <script src="/assets/javascript/bootstrap.min.js"></script>

        <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Interacting with editorial markup | Reference book for Verovio</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Interacting with editorial markup" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="MEI has a feature that lets us encode variant “readings” of a musical text. These readings may come from different sources of the same piece. A common type of alternate reading is a “contrafactum”, or alternate text. Typically this might occur between a Latin sacred text and a secular text in a vernacular, such as English, both set to the same music." />
<meta property="og:description" content="MEI has a feature that lets us encode variant “readings” of a musical text. These readings may come from different sources of the same piece. A common type of alternate reading is a “contrafactum”, or alternate text. Typically this might occur between a Latin sacred text and a secular text in a vernacular, such as English, both set to the same music." />
<meta property="og:site_name" content="Reference book for Verovio" />
<meta property="og:image" content="https://book.verovio.org/images/card.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-12-27T18:43:39+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="https://book.verovio.org/images/card.png" />
<meta property="twitter:title" content="Interacting with editorial markup" />
<meta name="twitter:site" content="@" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-12-27T18:43:39+00:00","datePublished":"2024-12-27T18:43:39+00:00","description":"MEI has a feature that lets us encode variant “readings” of a musical text. These readings may come from different sources of the same piece. A common type of alternate reading is a “contrafactum”, or alternate text. Typically this might occur between a Latin sacred text and a secular text in a vernacular, such as English, both set to the same music.","headline":"Interacting with editorial markup","image":"https://book.verovio.org/images/card.png","mainEntityOfPage":{"@type":"WebPage","@id":"/interactive-notation/editorial-markup.html"},"url":"/interactive-notation/editorial-markup.html"}</script>
<!-- End Jekyll SEO tag -->

    </head>
    <body>

        <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
     <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                </button>
            <a class="navbar-brand logo-nav" href="https://www.verovio.org/index.xhtml">
                <img alt="Verovio logo" src="/assets/images/verovio-fadded-50.png" />
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <ul class="nav navbar-nav navbar-right">
                <li >
                    <a href="https://www.verovio.org/index.xhtml">Homepage</a>
                </li>
                <li class="active">
                    <a href="https://book.verovio.org/">Reference book</a>
                </li>
                <li >
                    <a href="https://www.verovio.org/musicxml.html">Online tools</a>
                </li>
                <li>
                    <a class="image" href="https://github.com/rism-digital/verovio"><img alt="Verovio logo" src="/assets/images/github-logo.png" /></a>
                </li>
              </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


        <div class="top-header"> 
    <div class="container" style="color: #eee; height: 140px; padding-top: 5px;">
        <h1 style="color: #eee;" class="hidden-print hidden-xs">A music notation engraving library</h1> 
        <h3 style="color: #eee;" class="hidden-print visible-xs">A music notation engraving library</h3> 
        <p class="hidden-print">Designed for the Music Encoding Initiative - Fast - Light - Flexible - No dependencies</p>
    </div>
</div>


        <div class="container with-footer">

            



<div class="row">
    <div class="col-md-3 sidebar-offcanvas" id="sidebar">
        <div class="toc-group">
            <div>

    <a class="toc-item" href="/introduction/">Introduction</a>
    

    <a class="toc-item" href="/first-steps/">Tutorial 1: First Steps</a>
    

    <a class="toc-item" href="/interactive-notation/css-and-svg.html">Tutorial 2: Interactive notation</a>
    
        
        
<a class="toc-item toc-section " href="/interactive-notation/css-and-svg.html">CSS and SVG</a>
    

<a class="toc-item toc-section " href="/interactive-notation/encoding-formats.html">Encoding formats</a>
    

<a class="toc-item toc-section " href="/interactive-notation/playing-midi.html">Playing the MIDI output</a>
    

<a class="toc-item toc-section " href="/interactive-notation/content-selection.html">Score content selection</a>
    

<a class="toc-item toc-section selected" href="/interactive-notation/editorial-markup.html">Interacting with editorial markup</a>
    
        
        
<a class="toc-item toc-subsection" href="#selection-with-an-xpath-query">Selection with an xpath query</a>

<a class="toc-item toc-subsection" href="#switching-between-readings">Switching between readings</a>

<a class="toc-item toc-subsection" href="#full-example">Full example</a>

    

    

    <a class="toc-item" href="/advanced-topics/">Beyond tutorials: Advanced topics</a>
    

    <a class="toc-item" href="/toolkit-reference/input-formats.html">Toolkit Reference</a>
    

    <a class="toc-item" href="/installing-or-building-from-sources/command-line.html">Installing or building from sources</a>
    

    <a class="toc-item" href="/contributing/guidelines.html">Contributing</a>
    

</div>
            <div id="website-search-form" class="toc-item search-form">
    
    <form action="/search.html">
        <div class="form-group">
            <input id="website-search" class="form-control" type="text" name="q" placeholder="Search the reference book ...">
        </div>
        <button type="submit" class="btn btn-small">Search</button>
    </form>
</div>


        </div>
    </div>

    <div class="col-md-9" id="content">
        
        <a class="hidden-print" href="https://github.com/rism-digital/verovio-reference-book/edit/master/_book/03-interactive-notation/05-editorial-markup.md"><button class="btn btn-xs pull-right">Edit this page</button></a>
        
        
        <h2>Interacting with editorial markup</h2>
        <p>MEI has a feature that lets us encode variant “readings” of a musical text. These readings may come from different sources of the same piece. A common type of alternate reading is a “contrafactum”, or alternate text. Typically this might occur between a Latin sacred text and a secular text in a vernacular, such as English, both set to the same music.</p>

<p>Verovio supports the selection of variant readings encoded with MEI <code class="language-plaintext highlighter-rouge">&lt;app&gt;</code>, containing <code class="language-plaintext highlighter-rouge">&lt;lem&gt;</code> and <code class="language-plaintext highlighter-rouge">&lt;rdg&gt;</code> elements. Only one variant can be displayed at a time, and this is selected when the file is loaded. By default, Verovio selects the <code class="language-plaintext highlighter-rouge">&lt;lem&gt;</code> (or the first <code class="language-plaintext highlighter-rouge">&lt;rdg&gt;</code> if no <code class="language-plaintext highlighter-rouge">&lt;lem&gt;</code> is provided).</p>

<p>In this example we are going to create a basic interface to switch between variants by applying XPath queries for selecting specific readings, and then highlight the editorial markup in different colours. The MEI file we will use for this purpose comes from the Marenzio edition:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://raw.githubusercontent.com/marenzio/marenzio.github.io/master/mei/M-04-6/M_04_6_02_Di_nettare_amoroso_ebro_la_mente.mei
</code></pre></div></div>

<h3 id="selection-with-an-xpath-query">Selection with an xpath query</h3>

<p>The first thing we need is a variable to store the XPath queries. This must be an array, but we can start with an empty one, which applies the default behaviour:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">appXPath</span> <span class="o">=</span> <span class="p">[];</span>
</code></pre></div></div>

<p>Since Verovio selects the elements to be displayed when loading the file, we need to define a <code class="language-plaintext highlighter-rouge">loadFile()</code> function that applies the options, loads the file into Verovio, and renders it:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// A function that loads a file</span>
<span class="kd">function</span> <span class="nf">loadFile</span><span class="p">()</span> <span class="p">{</span>
  <span class="nf">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://raw.githubusercontent.com/marenzio/marenzio.github.io/master/mei/M-04-6/M_04_6_02_Di_nettare_amoroso_ebro_la_mente.mei</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nf">text</span><span class="p">())</span>
    <span class="p">.</span><span class="nf">then</span><span class="p">((</span><span class="nx">meiXML</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">tk</span><span class="p">.</span><span class="nf">setOptions</span><span class="p">({</span>
        <span class="na">pageWidth</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">clientWidth</span><span class="p">,</span>
        <span class="na">pageHeight</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">,</span>
        <span class="na">scale</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="na">scaleToPageSize</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">appXPathQuery</span><span class="p">:</span> <span class="nx">appXPath</span>
      <span class="p">});</span>
      <span class="nx">tk</span><span class="p">.</span><span class="nf">loadData</span><span class="p">(</span><span class="nx">meiXML</span><span class="p">);</span>
      <span class="nx">notationElement</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">tk</span><span class="p">.</span><span class="nf">renderToSVG</span><span class="p">(</span><span class="nx">currentPage</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>To load, or reload, the file we can now call the function:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">loadFile</span><span class="p">();</span>
</code></pre></div></div>

<p>In the CSS file we also have defined two rules:</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">g</span><span class="nc">.lem</span> <span class="p">{</span>
  <span class="py">fill</span><span class="p">:</span> <span class="no">darkcyan</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">g</span><span class="nc">.rdg</span> <span class="p">{</span>
  <span class="py">fill</span><span class="p">:</span> <span class="no">crimson</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>At this stage, because we have a <code class="language-plaintext highlighter-rouge">editorial-markup.css</code> with some rule highlighting for <code class="language-plaintext highlighter-rouge">lem</code> and <code class="language-plaintext highlighter-rouge">rdg</code> classes, the default <code class="language-plaintext highlighter-rouge">&lt;lem&gt;</code> should appear highlighted.</p>

<h3 id="switching-between-readings">Switching between readings</h3>

<p>To switch between the original and a reading (an English contrafactum text, in this case), we add two buttons, with two handlers that bind to the button event listeners:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"original"</span><span class="nt">&gt;</span>Original<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"contrafactum"</span><span class="nt">&gt;</span>Contrafactum<span class="nt">&lt;/button&gt;</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">originalHandler</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Do something to render the original</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">contrafactumHandler</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
 <span class="c1">// Do something to render the contrafactum</span>
<span class="p">}</span>

<span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">original</span><span class="dl">"</span><span class="p">).</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="nx">originalHandler</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">contrafactum</span><span class="dl">"</span><span class="p">).</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="nx">contrafactumHandler</span><span class="p">);</span>
</code></pre></div></div>

<p>The file example we are using has some readings encoded as follows:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;app&gt;</span>
  <span class="nt">&lt;lem</span> <span class="na">source=</span><span class="s">"Italian"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;verse&gt;</span>
      <span class="nt">&lt;syl&gt;</span>Di<span class="nt">&lt;/syl&gt;</span>
    <span class="nt">&lt;/verse&gt;</span>
  <span class="nt">&lt;/lem&gt;</span>
  <span class="nt">&lt;rdg</span> <span class="na">source=</span><span class="s">"English"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;verse&gt;</span>
      <span class="nt">&lt;syl&gt;</span>When<span class="nt">&lt;/syl&gt;</span>
    <span class="nt">&lt;/verse&gt;</span>
  <span class="nt">&lt;/rdg&gt;</span>
<span class="nt">&lt;/app&gt;</span>
</code></pre></div></div>

<p>To select the “English” reading (i.e., in the <code class="language-plaintext highlighter-rouge">contrafactumHandler</code>), we can write an xPath query selecting <code class="language-plaintext highlighter-rouge">&lt;rdg&gt;</code> elements with the corresponding <code class="language-plaintext highlighter-rouge">@source</code> value, in this case “English”, and then reload the file:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">appXPath</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">./rdg[@source='English']</span><span class="dl">"</span><span class="p">];</span>
<span class="nf">loadFile</span><span class="p">();</span>
</code></pre></div></div>

<p>For the original, we can reset Verovio by passing in an empty <code class="language-plaintext highlighter-rouge">appXPath</code> array:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">appXPath</span> <span class="o">=</span> <span class="p">[];</span>
<span class="nf">loadFile</span><span class="p">();</span>
</code></pre></div></div>

<p>When switching between the views you will notice that the colour of the text differs between the original <code class="language-plaintext highlighter-rouge">&lt;lem&gt;</code> and the English <code class="language-plaintext highlighter-rouge">&lt;rdg&gt;</code>.</p>

<h3 id="full-example">Full example</h3>

<p>Open <a href="/tutorials/editorial-markup.html" target="_blank">this example</a> in a new window.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;title&gt;</span>Interacting with editorial markup<span class="nt">&lt;/title&gt;</span>
        <span class="c">&lt;!-- A stylesheet for modifying the appearance of the editorial markup --&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"editorial-markup.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="nt">/&gt;</span>
        <span class="c">&lt;!-- Verovio --&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://www.verovio.org/javascript/develop/verovio-toolkit-wasm.js"</span> <span class="na">defer</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"original"</span><span class="nt">&gt;</span>Original<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"contrafactum"</span><span class="nt">&gt;</span>Contrafactum<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"prevPage"</span><span class="nt">&gt;</span>Previous page<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"nextPage"</span><span class="nt">&gt;</span>Next page<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"notation"</span><span class="nt">&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;script&gt;</span>
            <span class="cm">/** 
             Load Verovio
            **/</span>
            <span class="nb">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">DOMContentLoaded</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">verovio</span><span class="p">.</span><span class="nx">module</span><span class="p">.</span><span class="nx">onRuntimeInitialized</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
                <span class="c1">// This line initializes the Verovio toolkit</span>
                <span class="kd">const</span> <span class="nx">tk</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">verovio</span><span class="p">.</span><span class="nf">toolkit</span><span class="p">();</span>

                <span class="c1">// An array to keep xpath queries for selecting editorial markup</span>
                <span class="kd">let</span> <span class="nx">appXPath</span> <span class="o">=</span> <span class="p">[];</span>

                <span class="c1">// Keep a variable to the notation div id</span>
                <span class="kd">let</span> <span class="nx">notationElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">notation</span><span class="dl">"</span><span class="p">);</span>

                <span class="c1">// A function that loads the file</span>
                <span class="kd">function</span> <span class="nf">loadFile</span><span class="p">()</span> <span class="p">{</span>

                    <span class="nf">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://raw.githubusercontent.com/marenzio/marenzio.github.io/master/mei/M-04-6/M_04_6_02_Di_nettare_amoroso_ebro_la_mente.mei</span><span class="dl">"</span><span class="p">)</span>
                        <span class="c1">// ... then receives the response and "unpacks" the MEI from it</span>
                        <span class="p">.</span><span class="nf">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nf">text</span><span class="p">())</span>
                        <span class="p">.</span><span class="nf">then</span><span class="p">((</span><span class="nx">meiXML</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                        <span class="c1">// First we set the options, including the appXPathQuery one</span>
                        <span class="nx">tk</span><span class="p">.</span><span class="nf">setOptions</span><span class="p">({</span>
                            <span class="na">pageWidth</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">clientWidth</span><span class="p">,</span>
                            <span class="na">pageHeight</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">,</span>
                            <span class="na">scale</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
                            <span class="na">scaleToPageSize</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                            <span class="na">appXPathQuery</span><span class="p">:</span> <span class="nx">appXPath</span>
                        <span class="p">});</span>
                        <span class="c1">// ... then we can load the data into Verovio ...</span>
                        <span class="nx">tk</span><span class="p">.</span><span class="nf">loadData</span><span class="p">(</span><span class="nx">meiXML</span><span class="p">);</span>
                        <span class="c1">// ... and generate and set the SVG for the current page ...</span>
                        <span class="nx">notationElement</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">tk</span><span class="p">.</span><span class="nf">renderToSVG</span><span class="p">(</span><span class="nx">currentPage</span><span class="p">);</span>
                        <span class="p">});</span>
                    <span class="p">}</span>

                    <span class="c1">// The current page, which will change when playing through the piece</span>
                    <span class="kd">let</span> <span class="nx">currentPage</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

                    <span class="cm">/**
                        Wire up the button to actually work.
                    */</span>
                    <span class="kd">const</span> <span class="nx">nextPageHandler</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
                        <span class="nx">currentPage</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="nx">currentPage</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">tk</span><span class="p">.</span><span class="nf">getPageCount</span><span class="p">());</span>
                        <span class="nx">notationElement</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">tk</span><span class="p">.</span><span class="nf">renderToSVG</span><span class="p">(</span><span class="nx">currentPage</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="kd">const</span> <span class="nx">prevPageHandler</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
                        <span class="nx">currentPage</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="nx">currentPage</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                        <span class="nx">notationElement</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">tk</span><span class="p">.</span><span class="nf">renderToSVG</span><span class="p">(</span><span class="nx">currentPage</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="kd">const</span> <span class="nx">originalHandler</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
                        <span class="nx">appXPath</span> <span class="o">=</span> <span class="p">[];</span>
                        <span class="nf">loadFile</span><span class="p">();</span>
                    <span class="p">}</span>

                    <span class="kd">const</span> <span class="nx">contrafactumHandler</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
                        <span class="nx">appXPath</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">./rdg[@source='English']</span><span class="dl">"</span><span class="p">];</span>
                        <span class="nf">loadFile</span><span class="p">();</span>
                    <span class="p">}</span>

                    <span class="cm">/**
                        Wire up the buttons to actually work.
                    */</span>
                    <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">nextPage</span><span class="dl">"</span><span class="p">).</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="nx">nextPageHandler</span><span class="p">);</span>
                    <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">prevPage</span><span class="dl">"</span><span class="p">).</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="nx">prevPageHandler</span><span class="p">);</span>
                    <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">original</span><span class="dl">"</span><span class="p">).</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="nx">originalHandler</span><span class="p">);</span>
                    <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">contrafactum</span><span class="dl">"</span><span class="p">).</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="nx">contrafactumHandler</span><span class="p">);</span>

                    <span class="c1">// This line fetches the MEI file we want to render...</span>
                    <span class="nf">loadFile</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

    </div>
</div>

<script src="/js/highlighter.js"></script>

<script>
    let options = {
        rootMargin: '60px'
    }
    function adjustSideBar() {
        elem = document.getElementsByClassName("toc-group")[0];
        // 992 is the breakpoint for which the sidebar moves to the top; 35 is the footer height
        elem.style.height = (window.innerWidth < 992) ? "" : `${window.innerHeight - elem.offsetTop - 35}px`;
    }

    window.onresize = function () {
        adjustSideBar();
    };
    window.onload = function() {
        adjustSideBar();
    };

    window.addEventListener('DOMContentLoaded', () => {
        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                const id = entry.target.getAttribute('id');
                if (entry.intersectionRatio > 0) {
                    // First deselect everything
                    sections = document.querySelectorAll(`.toc-group a.toc-subsection`);
                    for (i = 0; i < sections.length; i++){
                        sections[i].classList.remove('selected');
                    }
                    // The one entering is marked as .on-screen
                    document.querySelector(`.toc-group a[href="#${id}"]`).classList.add('on-screen');
                    // Select the first that in .on-screen
                    sections = document.querySelectorAll(`.toc-group a.toc-subsection.on-screen`);
                    sections[0].classList.add('selected');

                } else {
                    leaving = document.querySelector(`.toc-group a[href="#${id}"]`)
                    // Remove the .on-screen from the one leaving
                    leaving.classList.remove('on-screen');
                    sections = document.querySelectorAll(`.toc-group a.toc-subsection.on-screen`);
                    // If no other one is on screen, just leave things as they are
                    if (sections.length > 0) {
                        // Otherwise de-select the one that is leaving
                        leaving.classList.remove('selected');
                        // Selected the first .on-screen one and de-select the other ones
                        sections[0].classList.add('selected');
                        for (i = 1; i < sections.length; i++){
                            console.log(sections[i].getAttribute('id'))
                            sections[i].classList.remove('selected');
                        }
                    }
                }
            });
        }, options);

        // Track all sections that have an `id` applied
        document.querySelectorAll('h3[id]').forEach((section) => {
            observer.observe(section);
        });

    });

    let params = new URLSearchParams( document.location.search.substring( 1 ) );
    if ( params.get( "q" ) )
    {
        let query = params.get( "q" );
        // Also make sure we preserve the query term in the form in the sidebar
        document.getElementById("website-search").value = query;
        // Preserve the original query for logging
        let query_term = query;
        // Remove quotes and trim
        query = query.replace(/\'|\"/g, ' ');
        query = query.trim();
        // Make it an AND query
        console.log(query);

        let terms = query.split(' ');
        var container = document.getElementById("content");

        for (var i = 0; i < terms.length; i++) {
            InstantSearch.highlight(container, terms[i]);
        }
    }

</script>



        </div>

        <footer class="hidden-print footer navbar-fixed-bottom">
            <p>
                
            </p>
        </footer>

        <script>
        //<![CDATA[
            $(document).ready(function() {

                

            });
        //]]>
        </script>
    </body>
</html>
